## IIC
### 物理层
全双工；
传输速率：标准：100kbits，快速模式：400kbits；高速模式：3.4Mbits。
设备线与。
### 协议层
总线空闲为高，开始传输时SDA需要在SCL为高时拉低，后传输SDA；停止时在SCL为高时跳到低即可。

在SDA进行数据传输时，有如下要求：
在SCL为高电平状态时，SDA拉低拉高表示数据帧的起始
在SCL为低电平状态时，SDA可以自由拉高拉低
也就是说，在SCL为高时，若是数据传输，则要求数据电平不变。

以E2PROM为例：
写的过程：
1. 主机向从机发送读写地址（7位器件地址和一位读写控制位）
2. 发送字节地址（写入存储器的地址），这个地址是字节地址
3. 发送写入数据，可以分为单次写或者页写（区别在与主机发送的下一字节数据还是停止信号）
![[Pasted image 20240129162830.png]]
![[Pasted image 20240129163144.png]]
读的过程：
分为当前地址读与，随机地址读与连续读：
1. 主机发送器件地址+写命令（虚写），再发送读的地址
2. 主机发送读命令从机发送数据

![[Pasted image 20240129163258.png]]
![[Pasted image 20240129163520.png]]
![[Pasted image 20240129163715.png]]
连续读只要把随机读的主机应答改成非应答即可终止读的过程

## RTL实现

### i2c_drv

核心：三段式状态机；将不同读写状态下的i2c作为状态机产生各种输出
+ 注意此模块驱动的时钟域频率是SCL时钟域的4倍，这样可以方便地满足I2C中SCL与SDA在不同情况下需要互相拉高拉低电平的情况
+ 根据时序图在对应时刻产生输出即可。
+ 从时序图中可以看出，SDA变化的周期是SCL的2倍
### e2prom_rw
用于向i2c_drv产生在i2c读写时需要的数据、地址、读写类型等信号；
同时用来判断读写是否正常

### 其他模块
LED显示输出
顶层模块

![[Pasted image 20240129224223.png]]