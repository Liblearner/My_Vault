## 概述
### 概念
FIFO：先进先出的数据缓存器。没有外部读写地址线，通过内部的读写计数器进行控制。在使用时顺序写入，顺序写出，不存在像RAM那样的读写冲突问题。
通常分为异步和同步FIFO。
同步：读时钟和写时钟是同一个时钟，时钟沿来临时同时发生读写操作。常用于处理两边数据处理带宽不一致的临时缓冲。异步FIFO指读写时钟不一致，读写时钟相互独立，一般用于数据信号跨时钟阈处理。
FIFO常见参数：
1. 宽度：FIFO一次读写操作的数据位宽N。
2. 深度：FIFO可以存储多少个宽度的N位的数据
3. 将空标志：almost_empty，FIFO即将被读空
4. 将满标志：almost_full，FIFO即将被写满
5. 空标志：empty，FIFO已空时由FIFO的状态电路送出的一个信号，以组织FIFO的读操作继续从FIFO中读出数据而造成无效数据的读出。FIFO即将被写满
6. 满标志：full，FIFO已满时由FIFO的状态电路送出的一个信号，以组织FIFO的写操作继续向FIFO中写数据而造成溢出。
7. 写时钟：写FIFO时所遵循的时钟，在每个时钟的上升沿触发
8. 读时钟：读FIFO时所遵守的时钟，在上升沿触发
9. 可配置满信号：prog_full，表示FIFO中存储的数据量达到可配置满阈值中配置的数据。
10. 可配置满阈值：影响可配置满信号于何时有效，其可配置范围一般为3~写深度-3。
11. 可配置空信号：prog_empty，表示FIFO中剩余的数据量已经减少到可配置空阈值中配置的数值
12. 可配置空阈值：表示FIFO中剩余的数据量已经可以减少到可配置空阈值中配置的数值。

tips: 
1. almost_empty与almost_full这两个信号分别被看做警告信号，对于空和满会被提前一个时钟周期拉高0
2. FIFO中，先写入的数据置于高位，后写入的置于低位。基于FIFO的特性，读出的数据也是高位在前。当读写位宽不一致时需要特别注意。

### 实现方式
1. 自己编写
2. 第三方开源IP，可以修改
3. 调用官方提供的IP，根据软件图形化界面进行参数编辑

本实验基于3.实现，vivado中FIFO Generato IP核的信号框图如下：
其中黑色必须，蓝色可选，灰色为可选的边带信号
![[Pasted image 20231211203419.png]]
详细功能可以参考其使用手册。
### 实践任务
生成一个异步FIFO，在FIFO为空时，不断向其中写入，写满之后停止，并且读出，读空之后停止。

## 实现过程
### IP核配置
配置界面如下：
1. Basic选项卡
![[Pasted image 20231211204757.png]]
	Interface Type：
	+ Native：常规
	+ AXI Memory Mapped（内存映射）：一般用于与PS端进行数据交互
	+ AXI Stream：一般应用与告诉信号处理场景，如光口通信
	FIFO实现：
	+ Block RAM：块RAM
	+ Distributed RAM：分布式RAM
	+ shift Register：移位寄存器(仅可以实现同步)
	+ Builtin FIFO：内置FIFO
Common Clock与Independent Clocks即是同步与异步。
一般来说，FIFO容量超过1024个Bytes就需要考虑使用BRAM，没超过可以选择分布式
后面基本用不到
其与还有“syschronization Stages（同步阶段）”：用于定义跨交叉时钟域逻辑的同步器级数，即设置读写状态信号的输出延迟。保持默认设置2即可。
以及FIFO其中实现方式的共5种详细特征，此处略

2. Native Ports选项卡
![[Pasted image 20231211205735.png]]
	重要配置如下：
	Read Mode：有Standard FIFO 与First Word Fall Through（首字直通，即预读模式）。标准模式的数据输出会比读使能延迟一拍。裕度模式的则同时输出。
	Data Port Parameters：用于设置FIFO的读写数据位宽和读写深度
	Initializaton：初始化，设置复位相关的参数，是否引入高有效的复位信号，是否启用同步复位（官方建议复位信号至少保持三个时钟周期（以慢为准）），且复位有效之后，建议30个周期之后才能对FIFO进行写操作；以及是否启用安全电路，是否向外输出读写忙信号；还有读延迟等等设置。
	这一部分大部分保持默认即可。
3. Status Flag选项卡
![[Pasted image 20231211213430.png]]
	1. Optional：可选标准
	可以选择是否输出将满与将空信号
	以及握手选项，可编程标志（影响prog_full和prog_empty）等等
4. Data Counts：
	更精确的计数：使用BRAM或者分布式RAM实现且使能预读模式时才用可以使能。
	其他略
5. Summary
	对之前的配置进行总结。
	![[Pasted image 20231211213838.png]]

### FIFO写模块设计
#### 原理
在写操作中，主要需要注意：
1. 需要在FIFO的复位完成之后再进行写，可以根据Busy进行判断。
2. 对FIFO的状态进行判断以进行合适的读操作，需要用到其相关的empty与full信号
3. 同时还需要控制FIFO的写使能与写数据端口。
模块示例图如下：
![[Pasted image 20231211232533.png]]

信号时序注意事项：
1. 其中empty是FIFO读时钟域下的异步信号，因此在输入处需要添加同步；
![[Pasted image 20231211232913.png]]

在empty信号产生之后，打2拍后延迟一个周期使能写，并且再延迟一个周期写数据，在almost_full置1之后停止写0。

### FIFO读模块设计
#### 原理
需求类似于写模块，只是数据流向有区别。
时序图如下:
![[Pasted image 20231211234628.png]]
![[Pasted image 20231211234643.png]]
## 上板调试

从vivado界面可以看到可以正常运行。但无法读取到ila调试核。初步判断是前面配置的问题。但懒得修改了。